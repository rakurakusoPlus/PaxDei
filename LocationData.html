<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pax Dei: Gallia 地名・伝承データベース</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style id="common-styles">
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #f8fafc; color: #334155; margin: 0; padding: 0; }
        
        /* テーブル基本スタイル */
        table { 
            border-collapse: separate; 
            border-spacing: 0; 
            width: 100%; 
            font-size: 0.875rem; /* スマホ用基準サイズ */
            border-top: 1px solid #e2e8f0;
            border-left: 1px solid #e2e8f0;
        }
        
        th, td { 
            border-right: 1px solid #e2e8f0; 
            border-bottom: 1px solid #e2e8f0; 
            padding: 12px 16px; 
            vertical-align: top; 
        }

        /* データ行のみ背景色を白にし、ヘッダー(th)は各設定の背景色を活かす */
        td {
            background-color: #fff;
        }
        
        /* ヘッダーの設定（検索バーの下に隠れるようにz-indexを調整） */
        th { 
            font-weight: 600; 
            text-align: left; 
            cursor: pointer; 
            position: sticky; 
            top: 0; 
            z-index: 30; 
            color: #fff; 
        }
        
        th:hover { filter: brightness(0.9); }
        th.sort-asc::after { content: " ▲"; font-size: 0.7em; position: absolute; right: 8px; top: 50%; transform: translateY(-50%); }
        th.sort-desc::after { content: " ▼"; font-size: 0.7em; position: absolute; right: 8px; top: 50%; transform: translateY(-50%); }
        
        /* 行の背景色 */
        tbody tr:nth-child(even) td { background-color: #f8fafc; }
        tbody tr:hover td { background-color: #eff6ff; }
        
        /* スクロールコンテナ */
        .data-table-container { 
            overflow-x: auto; 
            border-radius: 0.5rem; 
            background-color: #fff; 
            -webkit-overflow-scrolling: touch; 
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        /* ジャンプリンク横スクロールバー非表示 */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        @media (min-width: 768px) {
            table { font-size: 1rem; } /* PC用基準サイズを拡大 */
        }

        @media (max-width: 767px) {
            table { min-width: 750px; } /* スマホでも表を縮めずスクロールさせる */
        }

        #toast { visibility: hidden; min-width: 250px; background-color: #10b981; color: #fff; text-align: center; border-radius: 4px; padding: 16px; position: fixed; z-index: 100; left: 50%; bottom: 30px; transform: translateX(-50%); font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1); opacity: 0; transition: opacity 0.3s, bottom 0.3s; }
        #toast.show { visibility: visible; opacity: 1; bottom: 50px; }
    </style>
</head>
<body class="min-h-screen flex flex-col pb-16">

    <header class="bg-slate-900 text-white py-6 shadow-md relative z-50">
        <div class="max-w-5xl mx-auto px-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold tracking-tight">Pax Dei: Gallia 地名データベース</h1>
                <p class="mt-2 text-slate-400 text-sm md:text-base">地方（Province）ごとの語源・神話的背景の包括的リスト</p>
            </div>
            <div class="bg-slate-800 px-4 py-2 rounded shadow-inner border border-slate-700 flex items-center gap-2">
                <span class="text-slate-300 text-sm">表示件数:</span>
                <span class="font-bold text-xl text-white" id="stat-total">0</span>
            </div>
        </div>
    </header>

    <main id="main-container" class="max-w-5xl mx-auto px-4 py-6 md:py-8 flex flex-col gap-6 md:gap-8 w-full">
        <div class="bg-amber-50 border-l-4 border-amber-500 p-4 md:p-5 rounded-r-md shadow-sm">
            <div class="flex items-start gap-3">
                <span class="text-amber-500 text-xl md:text-2xl leading-none">⚠️</span>
                <div>
                    <h3 class="font-bold text-amber-800 text-base md:text-lg">当データベースに関する免責事項</h3>
                    <p class="text-amber-700 mt-1 leading-relaxed text-xs md:text-sm">
                        本リストの内容は、AIの調査に基づいて現実の歴史や神話から独自に推測し、まとめたものです。ゲーム内の公式な設定資料に基づくものではないため、<strong>地名の発音、語源、および神話的背景の解釈には誤りが含まれている可能性</strong>があります。あくまで冒険を楽しむための参考・考察資料としてご覧ください。
                    </p>
                </div>
            </div>
        </div>

        <section class="bg-white rounded-lg shadow-sm border border-slate-200 border-t-4 border-t-indigo-600">
            <div class="p-4 md:p-6 cursor-pointer flex justify-between items-center hover:bg-slate-50 transition-colors select-none" onclick="toggleIntro()">
                <h2 class="text-lg md:text-2xl font-bold text-slate-800">序論：Pax Deiの世界観とGalliaの舞台背景</h2>
                <span id="intro-icon" class="text-lg md:text-xl text-slate-500 transform transition-transform duration-300">▼</span>
            </div>
            <div id="intro-content" class="px-4 md:px-8 pb-6 md:pb-8 space-y-4 md:space-y-6 text-slate-700 text-xs md:text-sm leading-relaxed border-t border-slate-100 pt-4 hidden">
                <div>
                    <h3 class="font-bold text-base md:text-lg text-indigo-900 border-b border-indigo-100 pb-1 mb-2">■ 神話と歴史が交錯する並行世界</h3>
                    <p>『Pax Dei』の舞台は、中世ヨーロッパの人々が信じていた神話、伝承、迷信が「現実の物理法則」として実在する並行世界です。幽霊や魔法、神の奇跡といった超常的な存在が、単なるおとぎ話ではなく、実際に人々の生活や自然環境に影響を与えている世界を描いています。</p>
                </div>
                <div>
                    <h3 class="font-bold text-base md:text-lg text-indigo-900 border-b border-indigo-100 pb-1 mb-2">■ 冒険の地「Gallia」と地名が語る背景</h3>
                    <p>現在プレイヤーの冒険の舞台となっているメイン地域<strong>「Gallia（ガリア）」</strong>は、古代〜中世のフランスやヨーロッパの風土にインスパイアされています。本データベースの地名を紐解くと、この世界が単なるファンタジーではなく、<strong>「現実の歴史（南仏やフランク王国）」「土着のケルト神話」「アーサー王伝説や聖杯探求」</strong>といった複数の文化や伝承が融合して構築されていることが読み取れます。</p>
                </div>
                <div>
                    <h3 class="font-bold text-base md:text-lg text-indigo-900 border-b border-indigo-100 pb-1 mb-2">■ 地方（Province）とエリアの性質</h3>
                    <p class="mb-2">Galliaの内部はさらに<strong>「地方（Province）」</strong>に分割され、以下の環境が用意されています。</p>
                    <ul class="list-none space-y-2 bg-slate-50 p-4 md:p-5 rounded-md border border-slate-200">
                        <li>
                            <strong class="text-slate-800">🛡️ Non-PvP地域（Ancien, Inis Gallia, Kerys, Merrie）</strong>
                            <ul class="list-disc pl-5 mt-1 text-slate-600">
                                <li><strong class="text-emerald-700">Heartland（ハートランド）:</strong> 安全に定住し、家や村を建築できる平穏な生活の基盤。</li>
                                <li><strong class="text-amber-700">Wildland（ワイルドランド）:</strong> 建築は不可能だが、より希少な資源や危険な敵が潜む未開の地。</li>
                            </ul>
                        </li>
                        <li class="pt-2 border-t border-slate-200">
                            <strong class="text-slate-800">⚔️ 係争地域 / Contested Province（Lyonesse）</strong>
                            <p class="mt-1 text-slate-600 pl-5">プレイヤー同士の苛烈な戦闘（PvP）が展開される危険地帯。闘争と悲劇を象徴する地名が集中しています。</p>
                        </li>
                    </ul>
                </div>
                <div class="bg-indigo-50 p-3 md:p-4 rounded-md border-l-4 border-indigo-500 mt-4 text-indigo-900 shadow-sm">
                    <p class="font-bold mb-1 flex items-center gap-2"><span>💡</span> データベース上の表記に関する補足</p>
                    <p>ゲームサーバ（データセンター）のある地域を<strong>Region</strong>と表記しているため、それと混同しないようにするため、本資料では下位区分（KarrekやBrecilienなど）を<strong>エリア (Area)</strong>と一貫して表記しています。</p>
                </div>
            </div>
        </section>

        <div class="bg-white rounded-lg shadow-md border border-slate-200 p-3 md:p-4 flex flex-col gap-3 sticky top-0 md:top-2 z-50">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <input type="text" id="searchInput" placeholder="🔍 地名、読み方、説明などで検索..." class="w-full md:w-1/2 border border-slate-300 rounded-md p-2 md:p-2.5 text-sm md:text-base focus:ring-2 focus:ring-indigo-500 focus:outline-none bg-slate-50">
                <div class="flex gap-2 w-full md:w-auto">
                    <button onclick="copyToClipboard()" class="flex-1 md:flex-none bg-slate-100 hover:bg-slate-200 text-slate-800 font-semibold py-2 px-4 border border-slate-300 rounded-md shadow-sm text-xs md:text-sm transition flex items-center justify-center gap-1">📋 コピー</button>
                    <button onclick="downloadCSV()" class="flex-1 md:flex-none bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm text-xs md:text-sm transition flex items-center justify-center gap-1">⬇️ CSV保存</button>
                </div>
            </div>
            
            <div class="flex flex-nowrap overflow-x-auto hide-scrollbar items-center gap-1.5 md:gap-2 border-t border-slate-100 pt-2 pb-1" id="province-links">
                <span class="text-slate-500 font-bold py-1 text-[10px] md:text-sm uppercase tracking-tight whitespace-nowrap">📍Jump:</span>
                <a href="#prov-Lyonesse" class="prov-link px-2 py-1 md:px-3 md:py-1.5 bg-red-50 text-red-700 border border-red-200 hover:bg-red-100 rounded md:rounded-md font-medium text-[10px] md:text-sm whitespace-nowrap transition">Lyonesse</a>
                <a href="#prov-Ancien" class="prov-link px-2 py-1 md:px-3 md:py-1.5 bg-amber-50 text-amber-700 border border-amber-200 hover:bg-amber-100 rounded md:rounded-md font-medium text-[10px] md:text-sm whitespace-nowrap transition">Ancien</a>
                <a href="#prov-InisGallia" class="prov-link px-2 py-1 md:px-3 md:py-1.5 bg-purple-50 text-purple-700 border border-purple-200 hover:bg-purple-100 rounded md:rounded-md font-medium text-[10px] md:text-sm whitespace-nowrap transition">Inis Gallia</a>
                <a href="#prov-Kerys" class="prov-link px-2 py-1 md:px-3 md:py-1.5 bg-teal-50 text-teal-700 border border-teal-200 hover:bg-teal-100 rounded md:rounded-md font-medium text-[10px] md:text-sm whitespace-nowrap transition">Kerys</a>
                <a href="#prov-Merrie" class="prov-link px-2 py-1 md:px-3 md:py-1.5 bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100 rounded md:rounded-md font-medium text-[10px] md:text-sm whitespace-nowrap transition">Merrie</a>
                <span id="link-disabled-msg" class="text-[10px] md:text-sm text-rose-500 ml-1 hidden font-medium whitespace-nowrap">※検索中は無効</span>
            </div>
        </div>

        <div id="data-container" class="space-y-8 md:space-y-12 w-full"></div>
        
        <div id="noResults" class="hidden text-center py-12 text-slate-500 bg-white rounded-lg border border-slate-200 shadow-sm">
            <span class="text-3xl block mb-3">🔍</span> 条件に一致するデータが見つかりませんでした。
        </div>

    </main>

    <div id="toast">コピー完了しました！</div>

    <script>
        const isMobile = () => window.innerWidth < 768;
        let isInitialLoad = true;
        let provDescStates = {};

        const provincesDef = [
            { name: "Lyonesse", kana: "リオネス", title: "係争地域 (Contested Province)", color: "border-red-600", bg: "bg-red-900", desc: "イギリスのコーンウォール半島沖に存在し、海に沈んだとされる伝説の国「リオネス」に由来<br><br>「アーサー王伝説」や「聖杯伝説」、ブルターニュの「イス伝説」など、闘争と悲劇の物語に彩られた危険な係争地域（PvPエリア）です。過酷な環境が特徴で、特定の場所には「Feudal Shrine」が鎮座し、それ以外の土地には不吉な「Mournwood」が生い茂っています。<br><br><span class='font-bold text-slate-800'>【各エリア(Area)の背景】</span><br>・<strong class='text-slate-800'>Karrek (カレック):</strong> トリスタンとイゾルデの悲恋や、関連する騎士たちが集う地。<br>・<strong class='text-slate-800'>Brecilien (ブレシリエン):</strong> 妖精ヴィヴィアンが住まう魔法の森「ブロセリアンド」や、イス伝説など神秘的な伝承の色濃い地。<br>・<strong class='text-slate-800'>Avalon (アヴァロン):</strong> 伝説の終焉の地カムランや、死後の楽園アヴァロンを象徴する激戦と鎮魂の地。<br>・<strong class='text-slate-800'>Corbin (コービン):</strong> 聖杯伝説に登場するコルベニック城や、古代の激戦地・要塞の名を冠する過酷な地。<br>・<strong class='text-slate-800'>Central (セントラル):</strong> アーサー王の義兄ケイや聖杯探求の導き手など、物語の中核を担う存在が集まる中心地。" },
            { name: "Ancien", kana: "アンシアン", title: "Non-PvP地域 (オック語圏・南仏風)", color: "border-amber-500", bg: "bg-amber-700", desc: "フランス語で「古い」「古代の」を意味する言葉<br><br>フランス南部・オック語圏の歴史や風土にインスパイアされたNon-PvP地域（Heartland/Wildland）です。アキテーヌやガスコーニュといった歴史的地域、ボルドー地方の著名なワイン産地など、温暖で豊かな実在の地理・歴史がベースとなっており、古代から続く交易や農業の息吹を感じさせます。" },
            { name: "Inis Gallia", kana: "イニス・ガリア", title: "Non-PvP地域 (フランク王国・辺境風)", color: "border-purple-600", bg: "bg-purple-800", desc: "「Inis」はアイルランド語（ゲール語）で「島」を意味し、「Gallia」は古代ローマにおけるフランスの呼称「ガリア」を指す<br>ケルト文化とガリアが交わる「ガリアの島」という独自の造語<br><br>フランク王国やカロリング朝の歴史、およびヨーロッパ北部の深い森や険しい山脈をモチーフにしたNon-PvP地域（Heartland/Wildland）です。かつてのガリア＝ローマ時代の痕跡や、交通・軍事的な要衝として機能した高地など、少し冷涼で厳格な辺境的・修道院的な雰囲気が漂う地域です。" },
            { name: "Kerys", kana: "ケリス", title: "Non-PvP地域 (ケルト・ブルターニュ風)", color: "border-teal-600", bg: "bg-teal-800", desc: "フランス北西部のブルターニュ地方の伝説に登場する、王女ダリュの罪によって海に沈んだとされる都市「イス（Ker-Ys）」が直接の語源<br><br>フランス西部のブルターニュ地方（ケルト文化圏）の伝承や、ウェールズ語圏の文化に深く根ざしたNon-PvP地域（Heartland/Wildland）です。ブルトン語やウェールズ語で川、平原、丘陵を示す地形用語が多く用いられており、巨石遺跡や古代の海洋部族の記憶が息づく、神秘的で土着的なケルトの風が吹く地域となっています。" },
            { name: "Merrie", kana: "メリー", title: "Non-PvP地域 (古き良きイングランド風)", color: "border-blue-600", bg: "bg-blue-800", desc: "「古き良きイングランド」を意味する慣用句「Merrie England」が由来<br><br>イングランドやアイルランドの牧歌的な風景、アングロ・サクソン文化をベースにしたNon-PvP地域（Heartland/Wildland）です。なだらかな丘陵（ダウン）や湿原（泥炭地）、のどかな州（シャイア）など、トールキンの世界観にも通じる緑豊かで伝統的な景観を彷彿とさせる地名が付けられています。" }
        ];

        const feudalShrines = ["Darnantes", "Dolorous", "Sarras", "Blaye", "Carnac", "Guibel", "Badon", "Camlan", "Tara", "Catalaun", "Tournai", "Bar"];

        // 生データ全量（完全復元）
        const rawData = [
            // LYONESSE
            { province: "Lyonesse", area: "Karrek", areaKana: "カレック", name: "Segwarides", kana: "セグワリデス", origin: "アーサー王伝説の騎士", desc: "サラセン人（イスラム教徒）の血を引く円卓の騎士であり、トリスタンの恋のライバルの一人。彼の妻にトリスタンが懸想したことで血みどろの争いが生じた。" },
            { province: "Lyonesse", area: "Karrek", areaKana: "カレック", name: "Morholt", kana: "モルオルト", origin: "アイルランドの巨漢の騎士", desc: "イゾルデの叔父であり、アイルランドの強力な戦士。コーンウォールへの貢物を要求したが、若きトリスタンとの決闘の末に討ち取られ、物語の引き金となった。" },
            { province: "Lyonesse", area: "Karrek", areaKana: "カレック", name: "Palamedes", kana: "パラメデス", origin: "サラセン人の円卓の騎士", desc: "セグワリデスの兄弟であり、イゾルデに叶わぬ恋をした悲劇の騎士。伝説上の怪物「吠える獣」を生涯にわたって追及したことで知られる。" },
            { province: "Lyonesse", area: "Karrek", areaKana: "カレック", name: "Dinadan", kana: "ディナダン", origin: "円卓の騎士", desc: "武勇や名誉よりもユーモアと現実主義を重んじた異色の騎士。トリスタンの親しい友人であり、騎士道精神の不条理を皮肉る役割を担う。" },
            { province: "Lyonesse", area: "Karrek", areaKana: "カレック", name: "Tristan", kana: "トリスタン", origin: "リオネスの王子・騎士", desc: "アーサー王伝説屈指の悲恋物語の主人公。叔父マルク王の妃となるイゾルデと媚薬によって永遠の愛に落ち、数々の悲劇と闘争を引き起こす。" },
            { province: "Lyonesse", area: "Karrek", areaKana: "カレック", name: "Isolde", kana: "イゾルデ", origin: "アイルランドの王女", desc: "トリスタンの恋人。魔法の媚薬の力により、自らの意思に反して不義の恋に身を投じることになり、中世ヨーロッパの恋愛文学における運命の女（ファム・ファタール）の象徴。" },
            { province: "Lyonesse", area: "Karrek", areaKana: "カレック", name: "Darnantes", kana: "ダルナンデス", origin: "アーサー王伝説の森", desc: "散文ロマンスにおいて、大魔術師マーリンが湖の乙女（ヴィヴィアン）の妖術によって永遠に幽閉された暗く危険な森。" },
            { province: "Lyonesse", area: "Karrek", areaKana: "カレック", name: "Dolorous", kana: "ドロラス", origin: "聖杯伝説の用語", desc: "「悲痛」「苦悩」を意味する。バルス王が受けた癒えない傷「悲痛の一撃 (Dolorous Stroke)」や、呪われた「悲痛の城」に由来し、土地の呪いを象徴する。" },
            { province: "Lyonesse", area: "Karrek", areaKana: "カレック", name: "Sarras", kana: "サラス", origin: "聖杯伝説の聖なる都市", desc: "聖杯探求の最終地点。ガラハッド、パーシヴァル、ボールスの三騎士が聖杯を携えて到達した中東の架空の都市であり、究極の救済の地。" },
            { province: "Lyonesse", area: "Brecilien", areaKana: "ブレシリエン", name: "Morgause", kana: "モルゴース", origin: "アーサー王の異父姉", desc: "オークニーのロト王の妻であり、ガウェイン、アグラヴェイン、ガレスらの母。アーサー王との間に不義の子モルドレッドをもうけ、円卓崩壊の遠因を作った。" },
            { province: "Lyonesse", area: "Brecilien", areaKana: "ブレシリエン", name: "Dahut", kana: "ダリュ / ダフ", origin: "イス伝説の王女", desc: "ブルターニュ伝説に登場する都市「イス」の王女。悪魔に唆されて防波堤の鍵を盗み出し、自らの都市を海に沈めた大罪人。" },
            { province: "Lyonesse", area: "Brecilien", areaKana: "ブレシリエン", name: "Lamorak", kana: "ラモラック", origin: "円卓の騎士", desc: "ペリノア王の息子であり、ランスロットやトリスタンに匹敵する武勇を誇る。モルゴースとの密通が発覚し、彼女の息子たち（ガウェインら）によって暗殺された。" },
            { province: "Lyonesse", area: "Brecilien", areaKana: "ブレシリエン", name: "Ozana", kana: "オザナ", origin: "円卓の騎士", desc: "「オザナ・ル・キュール・アルディ（勇敢なる心を持つオザナ）」の異名で知られる騎士。数々の冒険に随行するが、しばしば引き立て役となる。" },
            { province: "Lyonesse", area: "Brecilien", areaKana: "ブレシリエン", name: "Viviane", kana: "ヴィヴィアン", origin: "湖の乙女", desc: "ランスロットを育て上げ、また大魔術師マーリンを誘惑してダルナンデスの森に封印した強大な力を持つ妖精。" },
            { province: "Lyonesse", area: "Brecilien", areaKana: "ブレシリエン", name: "Trecess Bride", kana: "トレセス・ブライド", origin: "土着神話の習合的造語", desc: "古代ガリアのトリカッシ族（Trecasses）と、ケルトの女神でありキリスト教の聖人にもなったブリギッド（Bride）を組み合わせた造語と推測される。" },
            { province: "Lyonesse", area: "Brecilien", areaKana: "ブレシリエン", name: "Blaye", kana: "ブライ", origin: "フランス南西部の都市", desc: "ジロンド川河口に位置する実在の要塞都市。叙事詩『ローランの歌』の英雄ローランが埋葬された伝説的な地。" },
            { province: "Lyonesse", area: "Brecilien", areaKana: "ブレシリエン", name: "Carnac", kana: "カルナック", origin: "ブルターニュの巨石遺跡", desc: "世界最大規模の巨石記念物（列石）群が存在するブルターニュ地方の実在の町。古代ケルトの神秘主義を象徴する。" },
            { province: "Lyonesse", area: "Brecilien", areaKana: "ブレシリエン", name: "Guibel", kana: "ギベル", origin: "イス伝説の城", desc: "ブルターニュ伝説において、ダリュ王女が夜な夜な新しい恋人を呼び寄せ、朝になると川へ突き落として殺害したとされる「カステル・ギベル（ギベル城）」。" },
            { province: "Lyonesse", area: "Avalon", areaKana: "アヴァロン", name: "Constantine", kana: "コンスタンティン", origin: "ブリテンの王", desc: "アーサー王の死後、崩壊した王国と王位を継承した人物。あるいは、ローマ帝国にキリスト教をもたらした歴史上の皇帝。" },
            { province: "Lyonesse", area: "Avalon", areaKana: "アヴァロン", name: "Guinevere", kana: "ギネヴィア", origin: "アーサー王の王妃", desc: "ランスロットとの許されざる不義の恋によって円卓の騎士たちを二分し、王国の滅亡を招いた悲劇の王妃。" },
            { province: "Lyonesse", area: "Avalon", areaKana: "アヴァロン", name: "Patrise", kana: "パトリス", origin: "アイルランドの騎士", desc: "王妃ギネヴィアが主催した宴において、ガウェインを暗殺しようと企てられた毒入り林檎を誤って食べ、無惨な死を遂げた人物。" },
            { province: "Lyonesse", area: "Avalon", areaKana: "Agravain", areaKana: "アヴァロン", name: "Agravain", kana: "アグラヴェイン", origin: "円卓の騎士", desc: "ガウェインの弟であり、ランスロットとギネヴィアの不義を執拗に暴き立て、結果として円卓の崩壊と内戦を引き起こした張本人。" },
            { province: "Lyonesse", area: "Avalon", areaKana: "アヴァロン", name: "Gareth", kana: "ガレス", origin: "円卓の騎士", desc: "ガウェインの末弟。ランスロットを深く敬愛していたが、ギネヴィアの火刑を阻止しようとしたランスロットによって、混乱の中で誤って殺害される。" },
            { province: "Lyonesse", area: "Avalon", areaKana: "アヴァロン", name: "Elain", kana: "エレイン", origin: "アーサー王伝説の女性名", desc: "聖杯伝説においてガラハッドを産んだ「コルベニックのエレイン」、あるいはランスロットに報われぬ愛を捧げて死んだ「アストラットの百合の乙女」。" },
            { province: "Lyonesse", area: "Avalon", areaKana: "アヴァロン", name: "Badon", kana: "バドン", origin: "伝説の古戦場", desc: "「ベドンの丘の戦い」。アーサー王がサクソン人の侵攻を食い止め、大勝を収めたとされるブリテン防衛の歴史的転換点。" },
            { province: "Lyonesse", area: "Avalon", areaKana: "アヴァロン", name: "Camlan", kana: "カムラン", origin: "最終戦争の地", desc: "「カムランの戦い」。アーサー王と反逆者モルドレッドが相打ちとなり、円卓の騎士の大多数が戦死した、アーサー王伝説における終末の地。" },
            { province: "Lyonesse", area: "Avalon", areaKana: "アヴァロン", name: "Tara", kana: "タラ", origin: "アイルランドの聖地", desc: "「タラの丘」。古代アイルランドにおける上王（ハイ・キング）たちの戴冠の地であり、ケルト神話における政治的・宗教的中心地。" },
            { province: "Lyonesse", area: "Corbin", areaKana: "コービン", name: "Sagramore", kana: "サグラモール", origin: "円卓の騎士", desc: "「荒々しいサグラモール（Sagramore le Desirous）」の異名を持ち、血の気が多く好戦的な性格で知られる騎士。" },
            { province: "Lyonesse", area: "Corbin", areaKana: "コービン", name: "Lucan the Butler", kana: "執事ルーカン", origin: "アーサー王の執事・騎士", desc: "王への絶対的な忠誠心を持つ。カムランの戦いの後、瀕死のアーサー王を抱え上げようとして自らの内臓が破裂し絶命した。" },
            { province: "Lyonesse", area: "Corbin", areaKana: "コービン", name: "Ector de Maris", kana: "エクター・ド・マリス", origin: "円卓の騎士", desc: "ランスロットの異母弟。数々の冒険を行うが、常に偉大な兄の影に隠れた存在であり、聖杯探求にも失敗する。" },
            { province: "Lyonesse", area: "Corbin", areaKana: "コービン", name: "Maleagant", kana: "メレアガント", origin: "反逆の騎士", desc: "アーサー王に敵対する国の王子。王妃ギネヴィアを誘拐するという騎士道に反する卑劣な行いをし、最後はランスロットに討たれる。" },
            { province: "Lyonesse", area: "Corbin", areaKana: "コービン", name: "Lionel", kana: "ライオネル", origin: "円卓の騎士", desc: "ランスロットの従兄弟。聖杯探求の過程で怒りに駆られ、実の兄弟であるボールスを殺害しようとするなど、精神的な脆さを見せる。" },
            { province: "Lyonesse", area: "Corbin", areaKana: "コービン", name: "Branwen", kana: "ブランウェン", origin: "ウェールズ神話の王女", desc: "『マビノギオン』の登場人物。アイルランド王に嫁ぐが虐待され、ウェールズとアイルランド間の壊滅的な戦争の火種となった悲劇の女性。" },
            { province: "Lyonesse", area: "Corbin", areaKana: "コービン", name: "Catalaun", kana: "カタラウン", origin: "古代の激戦地", desc: "「カタラウヌムの戦い（シャロンの戦い）」。西暦451年、ローマ・ガリア連合軍がフン族のアッティラ王の侵攻を食い止め、歴史的な大激戦地。" },
            { province: "Lyonesse", area: "Corbin", areaKana: "コービン", name: "Tournai", kana: "トゥルネー", origin: "ベルギーの最古の都市", desc: "ローマ帝国時代からの歴史を持ち、メロヴィング朝フランク王国の最初の首都として機能した重要な政治拠点。" },
            { province: "Lyonesse", area: "Corbin", areaKana: "コービン", name: "Bar", kana: "バル", origin: "フランスの歴史的領邦", desc: "フランス北東部に存在した「バル公国」。長きにわたりフランスと神聖ローマ帝国の間で翻弄された境界の地。" },
            { province: "Lyonesse", area: "Central", areaKana: "セントラル", name: "Amide", kana: "アミード", origin: "聖杯伝説の女性名", desc: "ランスロットを魔法で騙して関係を持ち、完全なる騎士ガラハッドを産んだ「コルベニックのエレイン」の別名。" },
            { province: "Lyonesse", area: "Central", areaKana: "セントラル", name: "Kay", kana: "ケイ", origin: "アーサー王の義兄", desc: "アーサー王が剣を抜く前から行動を共にし、宮廷の執事長を務める。口が悪く皮肉屋であるが、最古参の忠実な騎士。" },
            { province: "Lyonesse", area: "Central", areaKana: "セントラル", name: "Safir", kana: "サフィール", origin: "サラセン人の円卓の騎士", desc: "パラメデスの兄弟。キリスト教に改宗し円卓の騎士となるが、ランスロットとガウェインの派閥争いに巻き込まれ、故郷を追われる。" },
            { province: "Lyonesse", area: "Central", areaKana: "セントラル", name: "Dindrane", kana: "ディンドラン", origin: "聖杯探求の導き手", desc: "パーシヴァルの妹。ガラハッド、パーシヴァル、ボールスの三騎士を聖杯へと導くが、途中で癩病の乙女を救うために自らの血を捧げ尽くして命を落とす。" },
            
            // ANCIEN
            { province: "Ancien", area: "Armanhac", areaKana: "アルマニャック", name: "", kana: "", origin: "フランスの歴史的伯国", desc: "西暦601年にアキテーヌに設立されたガスコーニュ公国の一部「アルマニャック伯領」。世界的にも有名なブランデーの産地。" },
            { province: "Ancien", area: "Astarac", areaKana: "アスタラック", name: "", kana: "", origin: "フランスの歴史的伯国", desc: "フランス南西部、ガスコーニュ地方に存在した中世の伯国「アスタラック（Astarac）」。肥沃な農地が広がる。" },
            { province: "Ancien", area: "Gravas", areaKana: "グラヴァス", name: "", kana: "", origin: "ボルドーのワイン産地", desc: "ボルドー地方の著名なワイン産地「グラーヴ（Graves）」。ラテン語で「小石」を意味し、水はけの良い土壌を示す。" },
            { province: "Ancien", area: "Lavedan", areaKana: "ラヴダン", name: "", kana: "", origin: "ピレネー山脈の谷地", desc: "ピレネー山脈のふもとに位置するフランスの歴史的な谷地および地域。自然の要塞としての機能を持つ。" },
            { province: "Ancien", area: "Libornes", areaKana: "リボルヌ", name: "", kana: "", origin: "フランスの都市名", desc: "フランス南西部ジロンド県のコミューン「リブルヌ（Libourne）」。ドルドーニュ川沿いのワイン交易の中心地。" },
            { province: "Ancien", area: "Maremna", areaKana: "マレムヌ", name: "", kana: "", origin: "ランド県の歴史的地域", desc: "ランド県南部の海岸沿いに位置する歴史的地域「マレンヌ（Maremne）」。海に近い湿地帯という地理的特性を持つ。" },
            { province: "Ancien", area: "Salias", areaKana: "サリアス", name: "", kana: "", origin: "フランスの塩の町", desc: "フランス南西部ベアルン地方の「サリー＝ド＝ベアルン（Salies-de-Béarn）」。古代からの塩の産地であることに由来。" },
            { province: "Ancien", area: "Tolosa", areaKana: "トロサ", name: "", kana: "", origin: "フランスの主要都市", desc: "フランス南西部の中心都市「トゥールーズ（Toulouse）」のラテン語・オック語名。中世における文化・宗教の中心地。" },
            { province: "Ancien", area: "Tursan", areaKana: "テュルサン", name: "", kana: "", origin: "フランスのワイン産地", desc: "フランス南西部ランド県の歴史的地域および独自のワイン産地。緩やかな丘陵地帯が特徴。" },
            { province: "Ancien", area: "Volvestre", areaKana: "ヴォルヴェストル", name: "", kana: "", origin: "トゥールーズ近郊の地域", desc: "トゥールーズの南に位置するフランスの自然地域。ガロンヌ川の支流が織りなす緑豊かな景観を持つ。" },
            
            // INIS GALLIA
            { province: "Inis Gallia", area: "Aras", areaKana: "アラス", name: "", kana: "", origin: "フランス北部の都市", desc: "フランス北部パ＝ド＝カレー県の県都「アラス（Arras）」。中世においてはタペストリーや羊毛産業でヨーロッパ有数の繁栄を誇った。" },
            { province: "Inis Gallia", area: "Ardennes", areaKana: "アルデンヌ", name: "", kana: "", origin: "ヨーロッパの巨大な森", desc: "フランスからベルギー、ルクセンブルクにかけて広がる深い森「アルデンヌの森（Ardennes）」。歴史上、幾度も軍事的な自然の要害となった。" },
            { province: "Inis Gallia", area: "Atigny", areaKana: "アティニー", name: "", kana: "", origin: "カロリング朝の離宮", desc: "フランス北東部アルデンヌ県のコミューン「アティニー（Attigny）」。初期中世においてフランク王国の重要な離宮が置かれた。" },
            { province: "Inis Gallia", area: "Javerdus", areaKana: "ジャヴェルデュス", name: "", kana: "", origin: "フランスの実在地名の合成造語", desc: "実在するフランスの村「Javerdat（巨石遺跡が残る）」や「Javernant（狼の伝説が残る）」を掛け合わせ、古代ガリア風の接尾辞「-us」を付与した造語と推測されます。ゲーム内で「オオカミの洞窟」が存在する設定も、Javernantの伝承と符合します。" },
            { province: "Inis Gallia", area: "Jura", areaKana: "ジュラ", name: "", kana: "", origin: "ヨーロッパの山脈", desc: "フランス東部とスイスの国境に広がる「ジュラ山脈（Jura）」。地質学の「ジュラ紀」の語源でもある古い地層と険しい地形。" },
            { province: "Inis Gallia", area: "Langres", areaKana: "ラングル", name: "", kana: "", origin: "フランスの高原・都市", desc: "フランス北東部の都市および高原「ラングル（Langres）」。セーヌ川やマルヌ川の水源となる古代からの交通・軍事の要衝。" },
            { province: "Inis Gallia", area: "Morvian", areaKana: "モルヴァン", name: "", kana: "", origin: "ブルゴーニュの山塊", desc: "ブルゴーニュ地方の山塊および広大な森林地帯「モルヴァン（Morvan）」に由来。ケルト語で「黒い山」を意味するとされる。" },
            { province: "Inis Gallia", area: "Nones", areaKana: "ノヌ", name: "", kana: "", origin: "ローマ暦 / キリスト教", desc: "ローマ暦における「第9日（Nones）」、あるいはキリスト教の時課における「第九時（午後3時の祈り）」に関連する宗教的・時間的な名称。" },
            { province: "Inis Gallia", area: "Trecassis", areaKana: "トリカッシ", name: "", kana: "", origin: "古代ガリアの部族", desc: "古代ガリアに存在したケルト系部族「トリカッシ族（Tricasses）」。現在のフランスの都市トロワ（Troyes）の語源となった。" },
            { province: "Inis Gallia", area: "Vitry", areaKana: "ヴィトリー", name: "", kana: "", origin: "フランスの一般的な地名", desc: "フランス北東部の都市名「ヴィトリー＝ル＝フランソワ（Vitry-le-François）」など、ガリア＝ローマ時代に由来する一般的な地名。" },
            
            // KERYS
            { province: "Kerys", area: "Aven", areaKana: "アヴェン", name: "", kana: "", origin: "ブルトン語の「川」", desc: "ケルト系言語のブルトン語で「川」を意味する。フランスの「ポン＝タヴェン（Pont-Aven）」などにその名残が見られる。" },
            { province: "Kerys", area: "Bronyr", areaKana: "ブロニール", name: "", kana: "", origin: "ウェールズ語の接頭辞", desc: "ウェールズ語で「丘の胸（Bron-yr）」を意味し、小高い丘や斜面を示す地形的な特徴を表す地名。" },
            { province: "Kerys", area: "Dolavon", areaKana: "ドラヴォン", name: "", kana: "", origin: "ウェールズ語の合成語", desc: "ウェールズ語の「Dol（草地・牧草地）」と「Afon（川）」を組み合わせた「川辺の草地」を意味する牧歌的な地名。" },
            { province: "Kerys", area: "Dreger", areaKana: "ドレジェ", name: "", kana: "", origin: "ブルターニュの歴史的地域", desc: "ブルターニュ半島北部の歴史的地域「トレゴール（Trégor）」のブルトン語表記「Bro-Dreger」に由来する。" },
            { province: "Kerys", area: "Ewyas", areaKana: "エヴィアス", name: "", kana: "", origin: "ウェールズ辺境の古地名", desc: "ウェールズ南東部からイングランド西部にかけて広がる歴史的地域「エヴィアス（Ewyas）」。アングロ・サクソンとの激しい境界地帯。" },
            { province: "Kerys", area: "Llydaw", areaKana: "リダウ", name: "", kana: "", origin: "ウェールズ語のブルターニュ", desc: "イギリスのウェールズ語圏において、海を隔てた同族の地であるフランスの「ブルターニュ地方」そのものを指す言葉。" },
            { province: "Kerys", area: "Pladenn", areaKana: "プラデン", name: "", kana: "", origin: "ブルトン語の地形用語", desc: "ブルトン語で「高原」「平地」「皿状の地形（Plateau）」を意味する単語であり、平坦な土地を示す。" },
            { province: "Kerys", area: "Retz", areaKana: "レッツ", name: "", kana: "", origin: "ブルターニュの歴史的地域", desc: "ブルターニュ南部からロワール地方にかけての歴史的地域「ペイ・ド・レ（Pays de Retz）」。ジル・ド・レの領地としても有名。" },
            { province: "Kerys", area: "Tremen", areaKana: "トレメン", name: "", kana: "", origin: "ブルトン語の「通過」", desc: "ブルトン語で「通過する」「道程」「小道（Passage）」を意味する言葉であり、交通の要所や峠を示す。" },
            { province: "Kerys", area: "Vanes", areaKana: "ヴァンヌ", name: "", kana: "", origin: "ブルターニュの主要都市", desc: "ブルターニュ地方の主要都市「ヴァンヌ（Vannes / Gwened）」。古代にこの地を支配しカエサルに反抗した海洋部族「ウェネティ族」に由来。" },
            
            // MERRIE
            { province: "Merrie", area: "Ardbog", areaKana: "アードボッグ", name: "", kana: "", origin: "ケルト語と英語の合成語", desc: "ゲール語の「Ard（高い）」と、英語の「Bog（泥炭地、湿地）」の合成語。スコットランドやアイルランド特有の荒涼とした高層湿原を想起させる。" },
            { province: "Merrie", area: "Bearm", areaKana: "ベアルム", name: "", kana: "", origin: "古英語由来の語彙", desc: "古英語やアングロサクソン由来の名称。「Beorm（熊、あるいは力強い戦士）」に関連し、古き森の力強さを示す。" },
            { province: "Merrie", area: "Caster", areaKana: "カスター", name: "", kana: "", origin: "イングランドの地名接尾辞", desc: "ラテン語の「Castrum（ローマの軍営・要塞）」に由来する、ランカスター（Lancaster）などのイングランドの一般的な地名接尾辞。" },
            { province: "Merrie", area: "Down", areaKana: "ダウン", name: "", kana: "", origin: "地形用語 / アイルランド州名", desc: "イングランド南部のチョーク質のなだらかな丘陵地帯（Downs）、またはアイルランドのダウン州（County Down）に由来。" },
            { province: "Merrie", area: "Gael", areaKana: "ゲール", name: "", kana: "", origin: "ケルト系言語集団", desc: "アイルランド、スコットランド、マン島などでケルト系言語を話す民族的・文化的集団「ゲール人（Gaels）」に由来。" },
            { province: "Merrie", area: "Nene", areaKana: "ネネ", name: "", kana: "", origin: "イングランドの実在の川", desc: "イングランド東部をゆっくりと流れる実在の川「ネネ川（River Nene）」。肥沃な農地を潤す水源の象徴。" },
            { province: "Merrie", area: "Shire", areaKana: "シャイア", name: "", kana: "", origin: "イングランドの行政区画", desc: "イングランドの伝統的な行政区画「州（Shire）」。トールキンの作品に登場するホビット庄のように、極めて牧歌的な響きを持つ。" },
            { province: "Merrie", area: "Ulaid", areaKana: "ウレイド", name: "", kana: "", origin: "古代アイルランドの王国", desc: "古代アイルランドの北部に存在した強大な王国「アルスター（Ulster）」の古アイルランド語での呼称。英雄クー・フーリンの活躍の舞台。" },
            { province: "Merrie", area: "Wiht", areaKana: "ワイト", name: "", kana: "", origin: "イングランドの島名", desc: "イングランド南岸に浮かぶ「ワイト島（Isle of Wight）」の古英語における表記（Wiht）。ローマ時代から開けた土地。" },
            { province: "Merrie", area: "Yarborn", areaKana: "ヤーボーン", name: "", kana: "", origin: "古英語的な造語", desc: "古英語の「Yare（川、あるいは準備ができた）」と「Born/Burn（小川）」を思わせる、アングロサクソン風の響きを持つ造語。" }
        ];

        let currentData = [...rawData];
        let sortStates = {};

        function initApp() {
            // 初回アクセス時のみ、PCは開く・スマホは閉じる
            if (isInitialLoad) {
                const mobile = isMobile();
                const introContent = document.getElementById('intro-content');
                const introIcon = document.getElementById('intro-icon');
                if (mobile) {
                    introContent.classList.add('hidden');
                    introIcon.innerText = '▼';
                } else {
                    introContent.classList.remove('hidden');
                    introIcon.innerText = '▲';
                }
                
                provincesDef.forEach(prov => {
                    provDescStates[prov.name] = !mobile;
                });
                isInitialLoad = false;
            }
            renderTables();
        }

        function renderTables() {
            const container = document.getElementById('data-container');
            const mobile = isMobile();
            container.innerHTML = '';
            const noResults = document.getElementById('noResults');

            if (currentData.length === 0) {
                noResults.classList.remove('hidden');
            } else {
                noResults.classList.add('hidden');

                provincesDef.forEach(prov => {
                    let provData = currentData.filter(d => d.province === prov.name);
                    if (provData.length === 0) return;

                    // ソート
                    if (sortStates[prov.name]) {
                        const { col, asc } = sortStates[prov.name];
                        provData.sort((a, b) => {
                            let valA = a[col] || ''; let valB = b[col] || '';
                            if (valA < valB) return asc ? -1 : 1;
                            if (valA > valB) return asc ? 1 : -1;
                            return 0;
                        });
                    }

                    const isPvP = prov.name === "Lyonesse";
                    const getSortClass = (col) => (sortStates[prov.name] && sortStates[prov.name].col === col) ? (sortStates[prov.name].asc ? 'sort-asc' : 'sort-desc') : '';

                    const provId = 'prov-' + prov.name.replace(/\s+/g, '');
                    const section = document.createElement('section');
                    section.id = provId;
                    section.className = "bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-48";

                    // 開閉IDと状態取得
                    const descId = `desc-${prov.name.replace(/\s+/g, '')}`;
                    const iconId = `icon-${prov.name.replace(/\s+/g, '')}`;
                    const isOpen = provDescStates[prov.name];
                    const descHiddenClass = isOpen ? "" : "hidden";
                    const descIcon = isOpen ? "▲" : "▼";

                    let html = `
                        <div class="border-b border-slate-200 bg-slate-50">
                            <div class="p-4 md:p-6 flex justify-between items-center cursor-pointer select-none hover:bg-slate-100 transition-colors" onclick="toggleProvDesc('${prov.name}')">
                                <h3 class="text-xl md:text-2xl font-bold text-slate-800 border-l-4 ${prov.color} pl-3">
                                    ${prov.name} <span class="text-sm md:text-lg font-medium text-slate-500 ml-1">(${prov.kana})</span> <span class="hidden md:inline text-base font-normal text-slate-500 ml-2">- ${prov.title}</span>
                                </h3>
                                <span id="${iconId}" class="text-slate-500 font-bold px-2">${descIcon}</span>
                            </div>
                            <div id="${descId}" class="${descHiddenClass} px-4 md:px-6 pb-4 md:pb-6">
                                <div class="text-slate-600 text-xs md:text-sm leading-relaxed bg-white p-3 md:p-4 rounded border border-slate-100 shadow-sm mt-2">
                                    ${prov.desc}
                                </div>
                            </div>
                        </div>
                        <div class="data-table-container">
                    `;

                    // --- スマホ用 Lyonesse ---
                    const useGroupHeader = mobile && isPvP && (!sortStates[prov.name] || sortStates[prov.name].col === 'area');

                    if (useGroupHeader) {
                        html += `
                            <table>
                                <thead class="${prov.bg}">
                                    <tr>
                                        <th class="${getSortClass('name')}" onclick="handleSort('${prov.name}', 'name')" style="width:100px;">場所名</th>
                                        <th class="${getSortClass('origin')}" onclick="handleSort('${prov.name}', 'origin')" style="width:90px;">語源</th>
                                        <th class="${getSortClass('desc')}" onclick="handleSort('${prov.name}', 'desc')">詳細背景</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
                        let currentArea = "";
                        provData.forEach(row => {
                            if (row.area !== currentArea) {
                                html += `<tr>
                                    <td colspan="3" class="py-2 px-3 border-b border-indigo-200 bg-indigo-50 text-indigo-900 font-bold whitespace-nowrap md:text-base">
                                        ${row.area} <span class="text-[11px] md:text-[13px] font-normal opacity-80 ml-1">(${row.areaKana})</span>
                                    </td>
                                </tr>`;
                                currentArea = row.area;
                            }
                            
                            let tags = feudalShrines.includes(row.name) 
                                ? `<div class="mt-1"><span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-red-100 border border-red-200 shadow-sm text-xs" title="Feudal Shrine">🏛️</span></div>` 
                                : `<div class="mt-1"><span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-purple-100 border border-purple-200 shadow-sm text-xs" title="Mournwood">🌲</span></div>`;
                            
                            html += `
                                <tr>
                                    <td class="font-bold text-slate-900 md:text-base">${row.name}<br><span class="text-[11px] md:text-[13px] font-normal text-slate-500">${row.kana}</span>${tags}</td>
                                    <td class="text-xs md:text-sm text-slate-600 font-medium">${row.origin}</td>
                                    <td class="leading-relaxed text-sm md:text-base text-slate-700">${row.desc}</td>
                                </tr>
                            `;
                        });
                        html += `</tbody></table></div>`;

                    } else {
                        // --- PC版 ＆ スマホ版Non-PvP ---
                        
                        // PCは左側の列幅を広く取って「詳細背景」を狭くして読みやすく、スマホは狭くして横スクロールのバランスを取る
                        let areaWidth = mobile ? '90px' : (isPvP ? '140px' : '180px');
                        let nameWidth = mobile ? '100px' : '200px'; // Lyonesse用
                        let originWidth = mobile ? '90px' : '250px';

                        html += `
                            <table>
                                <thead class="${prov.bg}">
                                    <tr>
                                        <th class="${getSortClass('area')}" onclick="handleSort('${prov.name}', 'area')" style="width:${areaWidth};">エリア</th>
                                        ${isPvP ? `<th class="${getSortClass('name')}" onclick="handleSort('${prov.name}', 'name')" style="width:${nameWidth};">場所名</th>` : ''}
                                        <th class="${getSortClass('origin')}" onclick="handleSort('${prov.name}', 'origin')" style="width:${originWidth};">語源</th>
                                        <th class="${getSortClass('desc')}" onclick="handleSort('${prov.name}', 'desc')">詳細な背景・環境的文脈</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;

                        let skipAreaTd = 0;
                        provData.forEach((row, index) => {
                            let tags = "";
                            if (isPvP) {
                                if (mobile) {
                                    tags = feudalShrines.includes(row.name) 
                                        ? `<div class="mt-1"><span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-red-100 border border-red-200 shadow-sm text-xs" title="Feudal Shrine">🏛️</span></div>` 
                                        : `<div class="mt-1"><span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-purple-100 border border-purple-200 shadow-sm text-xs" title="Mournwood">🌲</span></div>`;
                                } else {
                                    tags = feudalShrines.includes(row.name) 
                                        ? `<div class="mt-2"><span class="inline-flex items-center px-2 py-1 rounded text-xs font-bold bg-red-100 text-red-800 border border-red-200 shadow-sm whitespace-nowrap">🏛️ Feudal Shrine</span></div>` 
                                        : `<div class="mt-2"><span class="inline-flex items-center px-2 py-1 rounded text-xs font-bold bg-purple-100 text-purple-800 border border-purple-200 shadow-sm whitespace-nowrap">🌲 Mournwood</span></div>`;
                                }
                            }

                            let areaTd = "";
                            if (isPvP && skipAreaTd === 0) {
                                let rowspan = 1;
                                for (let j = index + 1; j < provData.length; j++) if (provData[j].area === row.area) rowspan++; else break;
                                skipAreaTd = rowspan - 1;
                                areaTd = `<td rowspan="${rowspan}" class="font-bold text-center md:text-base" style="vertical-align: middle;">${row.area}<br><span class="text-[11px] md:text-[13px] font-normal text-slate-500">${row.areaKana}</span></td>`;
                            } else if (!isPvP) {
                                areaTd = `<td class="font-bold md:text-base">${row.area}<br><span class="text-[11px] md:text-[13px] font-normal text-slate-500">${row.areaKana}</span></td>`;
                            } else if (isPvP) { skipAreaTd--; }

                            html += `
                                <tr>
                                    ${areaTd}
                                    ${isPvP ? `<td class="font-bold text-slate-900 md:text-base">${row.name}<br><span class="text-[11px] md:text-[13px] font-normal text-slate-500">${row.kana}</span>${tags}</td>` : ''}
                                    <td class="text-xs md:text-sm text-slate-600 font-medium">${row.origin}</td>
                                    <td class="leading-relaxed text-sm md:text-base text-slate-700">${row.desc}</td>
                                </tr>
                            `;
                        });
                        html += `</tbody></table></div>`;
                    }

                    section.innerHTML = html;
                    container.appendChild(section);
                });
            }
            document.getElementById('stat-total').innerText = currentData.length;
        }

        window.toggleProvDesc = function(provName) {
            const desc = document.getElementById(`desc-${provName.replace(/\s+/g, '')}`);
            const icon = document.getElementById(`icon-${provName.replace(/\s+/g, '')}`);
            if (desc.classList.contains('hidden')) {
                desc.classList.remove('hidden');
                provDescStates[provName] = true;
                if (icon) icon.innerText = '▲';
            } else {
                desc.classList.add('hidden');
                provDescStates[provName] = false;
                if (icon) icon.innerText = '▼';
            }
        };

        window.toggleIntro = () => {
            const content = document.getElementById('intro-content');
            const icon = document.getElementById('intro-icon');
            content.classList.toggle('hidden');
            icon.innerText = content.classList.contains('hidden') ? '▼' : '▲';
        };

        window.handleSort = function(provName, col) {
            if (!sortStates[provName]) sortStates[provName] = { col: col, asc: true };
            else if (sortStates[provName].col === col) sortStates[provName].asc = !sortStates[provName].asc;
            else sortStates[provName] = { col: col, asc: true };
            renderTables();
        };

        function applySearch() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const msg = document.getElementById('link-disabled-msg');
            const links = document.querySelectorAll('.prov-link');
            
            if (!term) {
                currentData = [...rawData];
                msg.classList.add('hidden');
                links.forEach(l => l.classList.remove('opacity-40', 'pointer-events-none'));
            } else {
                currentData = rawData.filter(r => (r.name + r.kana + r.desc + r.origin + r.area + (r.areaKana||"")).toLowerCase().includes(term));
                msg.classList.remove('hidden');
                links.forEach(l => l.classList.add('opacity-40', 'pointer-events-none'));
            }
            renderTables();
        }

        window.copyToClipboard = () => {
            let t = "Province\tArea\tLocation\tOrigin\tDescription\n";
            currentData.forEach(row => {
                let tag = row.province === "Lyonesse" ? (feudalShrines.includes(row.name) ? " [Shrine]" : " [Mournwood]") : "";
                t += `${row.province}\t${row.area}(${row.areaKana})\t${row.name}(${row.kana})\t${row.origin}\t${row.desc}${tag}\n`;
            });
            navigator.clipboard.writeText(t).then(() => {
                const toast = document.getElementById('toast'); toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            });
        };

        window.downloadCSV = () => {
            let c = '\uFEFFProvince,Area,Location,Origin,Description\n';
            currentData.forEach(row => {
                let tag = row.province === "Lyonesse" ? (feudalShrines.includes(row.name) ? " [Shrine]" : " [Mournwood]") : "";
                c += `"${row.province}","${row.area}(${row.areaKana})","${row.name}(${row.kana})","${row.origin}","${row.desc}${tag}"\n`;
            });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(new Blob([c], { type: 'text/csv;charset=utf-8;' }));
            link.download = "PaxDei_Gallia_Database.csv"; link.click();
        };

        document.getElementById('searchInput').addEventListener('input', applySearch);
        window.addEventListener('resize', renderTables);
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
